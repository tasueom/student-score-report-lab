{% extends "layout.html" %}
{% block title %}성적 입력{% endblock %}
{% block content %}
<main>
    <h2>성적 입력</h2>
    <div class="upload-buttons">
        <button type="button" class="btn-upload btn-csv" onclick="toggleUpload('csv')" title="CSV 업로드">
            <i class="fas fa-file-alt"></i>
        </button>
        <button type="button" class="btn-upload btn-json" onclick="toggleUpload('json')" title="JSON 업로드">
            <i class="fas fa-code"></i>
        </button>
        <button type="button" class="btn-upload btn-img" onclick="toggleUpload('img')" title="이미지 업로드">
            <i class="fas fa-image"></i>
        </button>
    </div>
</main>
<div>
    <!-- CSV 업로드 폼 -->
    <form id="csv-upload-form" class="upload-form" method="post" action="{{ url_for('upload_csv') }}" enctype="multipart/form-data">
        <div>
            <label for="csv-file">CSV 파일로 업로드</label>
            <input type="file" id="csv-file" name="file" accept=".csv" required>
        </div>
        <div>
            <button type="submit">업로드</button>
            <button type="button" class="btn-cancel" onclick="toggleUpload('csv')">취소</button>
        </div>
    </form>

    <!-- JSON 업로드 폼 -->
    <form id="json-upload-form" class="upload-form" method="post" action="{{ url_for('upload_json') }}" enctype="multipart/form-data">
        <div>
            <label for="json-file">JSON 파일로 업로드</label>
            <input type="file" id="json-file" name="file" accept=".json" required>
        </div>
        <div>
            <button type="submit">업로드</button>
            <button type="button" class="btn-cancel" onclick="toggleUpload('json')">취소</button>
        </div>
    </form>

    <!-- 이미지 업로드 폼 -->
    <form id="img-upload-form" class="upload-form" method="post" action="{{ url_for('upload_img') }}" enctype="multipart/form-data">
        <div>
            <label for="img-file">이미지 파일로 업로드</label>
            <input type="file" id="img-file" name="file" accept=".jpg,.jpeg,.png" required>
        </div>
        <div>
            <button type="submit">업로드</button>
            <button type="button" class="btn-cancel" onclick="toggleUpload('img')">취소</button>
        </div>
    </form>

    <!-- 이미지에서 추출된 정보 입력 폼 -->
    {% if extracted_result %}
    <div class="extracted-form-container">
        <form method="post" action="{{ url_for('input') }}" onsubmit="return validateForm()" class="extracted-form">
            <div>
                <label for="extracted-id">학번</label>
                <input type="text" id="extracted-id" name="id" value="{{ extracted_result[0] }}" required>
            </div>
            <div>
                <label for="extracted-kor">국어</label>
                <input type="number" id="extracted-kor" name="kor" value="{{ extracted_result[1] }}" required>
            </div>
            <div>
                <label for="extracted-eng">영어</label>
                <input type="number" id="extracted-eng" name="eng" value="{{ extracted_result[2] }}" required>
            </div>
            <div>
                <label for="extracted-math">수학</label>
                <input type="number" id="extracted-math" name="math" value="{{ extracted_result[3] }}" required>
            </div>
            <div>
                <button type="submit">입력</button>
            </div>
        </form>
        <div class="extracted-image">
            <img src="data:image/png;base64,{{ extracted_result[4] }}" alt="업로드한 이미지">
        </div>
    </div>
    {% elif no_score_students %}
    <form method="post" action="{{ url_for('input') }}" onsubmit="return validateForm()">
        <div>
            <label for="id">학번</label>
            <select id="id" name="id" required>
                <option value="" selected disabled hidden>학번을 선택하세요</option>
                {% for student in no_score_students %}
                <option value="{{ student[0] }}">{{ student[0] }} - {{ student[1] }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="kor">국어</label>
            <input type="number" id="kor" name="kor" required>
        </div>
        <div>
            <label for="eng">영어</label>
            <input type="number" id="eng" name="eng" required>
        </div>
        <div>
            <label for="math">수학</label>
            <input type="number" id="math" name="math" required>
        </div>
        <div>
            <button type="submit">입력</button>
        </div>
    </form>
    {% else %}
    <p class="message-p">성적을 입력할 학생이 없습니다.</p>
    {% endif %}
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/uploadBtn.js') }}"></script>
{% endblock %}